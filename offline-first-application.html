<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Offline First Application | Rakawm</title>
    <meta name="description" content="Software Engineer, Motorcycle Enthusiast">
    
    
    <link rel="preload" href="/assets/css/0.styles.021a0155.css" as="style"><link rel="preload" href="/assets/js/app.677728b0.js" as="script"><link rel="preload" href="/assets/js/6.a04bd145.js" as="script"><link rel="prefetch" href="/assets/js/3.40849f77.js"><link rel="prefetch" href="/assets/js/2.61c5963e.js"><link rel="prefetch" href="/assets/js/4.18ecf1d4.js"><link rel="prefetch" href="/assets/js/5.9674cecb.js"><link rel="prefetch" href="/assets/js/7.8b0e9971.js"><link rel="prefetch" href="/assets/js/8.ed9cf4df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.021a0155.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Rakawm
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/rakawestu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/rakawestu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><a href="/" class="sidebar-link">Hello World</a></li><li><a href="/android-modular.html" class="sidebar-link">Modular Android Project</a></li><li><a href="/initialize-your-own-android-library-project-from-scratch.html" class="sidebar-link">Initialize Your Own Android Library Project from Scratch</a></li><li><a href="/publishing-android-library-to-bintray.html" class="sidebar-link">Publishing Android Library to Bintray</a></li><li><a href="/reactive-single-data-source-android.html" class="sidebar-link">Single Data Source Reactive Android Application</a></li><li><a href="/offline-first-application.html" class="active sidebar-link">Offline First Application</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/offline-first-application.html#offline-storage-data-layer" class="sidebar-link">Offline Storage - Data Layer</a></li><li class="sidebar-sub-header"><a href="/offline-first-application.html#background-worker-data-layer" class="sidebar-link">Background Worker - Data Layer</a></li><li class="sidebar-sub-header"><a href="/offline-first-application.html#use-cases-domain-layer" class="sidebar-link">Use Cases / Domain Layer</a></li></ul></li></ul></div><div class="page"><div class="content"><h1 id="offline-first-application"><a href="#offline-first-application" aria-hidden="true" class="header-anchor">#</a> Offline First Application</h1><p>Long time no see guys. Today I want to write about how I write an Android application that can be used in offline mode but still need to store data in server when internet connection is available.</p><p>The example use case is <em>Point of Sales</em> app. This kind of application is used by cashier to record the transactions happened in offline store.
The application has to work even when there are no internet connection available because customer is not expected to wait too long.</p><p>What is the scenario?</p><ol><li>When creating order and transaction, we have to assume <strong>no internet connection is available</strong> so we need to store the order and transaction data in local storage first.</li><li>After the order and transaction data are saved into local storage, then we can sync the data to our backend (if needed) immediately using background worker so it doesn't affect UI because cashier may have another customers to serve.</li><li>When step number 2 is failed we can set the worker to retry using exponential backoff so it won't affect backend too much when backend is having problems and already up again.</li><li>Last backup, we have scheduled worker that checks if there are <em>unsynced</em> transactions every xx hours.</li></ol><p>How can we achieve this?</p><p>Code-wise, we'll divide the thing into two layers.</p><ul><li>Data layer. In this layer, we define how data is saved into SQLite DB.</li><li>Domain / Use Case. In this layer, we define the business use case that may depends on several queries on data layer. Several examples:</li></ul><h2 id="offline-storage-data-layer"><a href="#offline-storage-data-layer" aria-hidden="true" class="header-anchor">#</a> Offline Storage - Data Layer</h2><p>Firstly, we need to decide which <em>offline storage</em> solution that we want to use. Android app can use default SQL based solution provided by SQLite as the local storage.
In this use case, we decide to use SQLite because order and transaction data is structured so it's easier to use SQL based solution which is SQLite.</p><p>In this use case, we define that we need to store data in two tables: <code>orders</code> and <code>transactions</code>.</p><ul><li>Order data
<ul><li>order id or order number</li><li>created at timestamp</li><li>order items</li><li>order status</li></ul></li><li>Transactions data include
<ul><li>transaction id</li><li>order id</li><li>paid amount</li><li>payment type</li><li>paid at timestamp</li></ul></li></ul><h2 id="background-worker-data-layer"><a href="#background-worker-data-layer" aria-hidden="true" class="header-anchor">#</a> Background Worker - Data Layer</h2><p>There are some libraries we can use to create a worker, but now I will just provide how to define the worker suited in our use cases.</p><p>We need to define some worker to sync our data:</p><ul><li>Sync order worker
<ul><li>Order id is provided</li><li>Worker will query to local database to get the order data based on order id</li><li>Format it into JSON</li><li>Sync JSON formatted data into backend</li><li>Flag it to <code>synced</code> so it doesn't need to be synced again.</li></ul></li><li>Sync transaction worker
<ul><li>Transaction id is provided</li><li>Worker will query to local database to get the transaction data based on transaction id</li><li>Format it into JSON</li><li>Sync JSON formatted data into backend</li><li>Flag it to <code>synced</code> so it doesn't need to be synced again.</li></ul></li><li>Scheduled data sync worker.
<ul><li>Every <code>xx</code> hours the worker will check if there are <em>unsynced order and transaction data</em></li><li>Format it into JSON</li><li>Sync JSON formatted data into backend</li><li>Flag it to <code>synced</code> so it doesn't need to be synced again.</li></ul></li></ul><h2 id="use-cases-domain-layer"><a href="#use-cases-domain-layer" aria-hidden="true" class="header-anchor">#</a> Use Cases / Domain Layer</h2><p>We can compose a business use case using several data layer functions. Some examples:</p><ul><li>Create pending order
<ol><li>Create a row in <code>orders</code> table with <code>pending</code> status</li><li>Sync pending order data into backend using <code>order worker</code></li></ol></li><li>Save paid order
<ol><li>Update order status from <code>pending</code> into <code>fulfilled</code></li><li>Sync fulfilled order data into backend using <code>sync order worker</code></li><li>Create a row in <code>transactions</code> table with <code>paid</code> status with related <code>order id</code> in <code>orders</code> table.</li><li>Sync paid transaction data into backend using <code>sync transaction worker</code></li></ol></li></ul><p>That's my idea about how we can achieve the *offline first application`. I will write some code examples in my next post. See you üòÉ</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê <a href="/reactive-single-data-source-android.html" class="prev">
          Single Data Source Reactive Android Application
        </a></span><!----></p></div></div></div></div>
    <script src="/assets/js/6.a04bd145.js" defer></script><script src="/assets/js/app.677728b0.js" defer></script>
  </body>
</html>
